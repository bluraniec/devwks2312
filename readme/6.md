## Chapter 4 - Cisco NSO

> :white_check_mark: We know already what is the NSO.  
> :arrow_down: Now it's the time to dirty our hands and check the basics of how does it work! <br>
> Let's start! :clap: :muscle: 

### 1st step - Review the Service
Review design of the bgp-shut Service that has been already created in the Cisco NSO. 
The purpose of this simple service is to shutdown particular BGP neighbor under device BGP process.
```console
NSO(config)# bgp-shut <instance-name> device <device-name> neighbor <neighbor-ip>
```

Usually the Service will be much more complicated – e.g. L2VPN, L3VPN with Traffic Engineering parameters that can be changed respectively to the telemetry feedback.

### 2nd step - Retrieve notification & send update
Open new terminal for Ubuntu using shortcut in the Desktop which will simulate SSH connectivity to the Virtual Machine through the Putty software.  

In order to create the Service using NSO – you can:
- use CLI (as in the example in the previous step)
- create a RESTCONF call from the code

1.	Review RESTCONF call in order to create a bgp-shut Service instance TEST on XR1 device to shutdown BGP neighbor 192.168.0.2.

**HTTP POST  
URL: http://198.18.134.28:8080/restconf/data  
Auth: admin/admin  
Headers: Content-Type: application/yang-data+json  
                 Accept: application/yang-data+json  
Payload: { bgp-shut:bgp-shut: [{ name: TEST, device-name: XR1, neighbor-ip: 192.168.0.2 }] }**

2.	Review Python script which is:
- creating Flask server and binding to port 5000 in order to listen for coming Grafana notifications (HTTP POST)
- counting notifications coming from Grafana (one BGP neighbor flap = Active -> Down -> Active state)
- if there are more than 2 flaps during 3 minutes – create RESTCONF request each time receiving a notification – to shut down the neighbor

3.	Run script by issuing command:
```console
root@ubuntu:~/# python3 shut.py
```
4.	Leave it running, do not stop/close it.


### 3rd step - Verify callback
Open another new terminal for Ubuntu using shortcut in the Desktop which will simulate SSH connectivity to the Virtual Machine through the Putty software.  
1.	Generate neighborship flaps and check if the device configuration has been changed – neighbors are shut down. 
2.	Run script by issuing command:
```console
root@ubuntu:~/# python3 flap.py
```
Leave it running, do not stop/close it.
3.	Go back to the browser and observe Grafana dashboard, you :


---
<h4 align="center">[7/8]</h4>
<h4 align="center"> <a href="/readme/5.md"> :arrow_left: Alerting </a> || <a href="/readme/7.md"> Summary :arrow_right: </a> </h4>
